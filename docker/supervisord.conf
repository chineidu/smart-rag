
[supervisord]
logfile=/tmp/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
nodaemon=true
minfds=1024
minprocs=200

[unix_http_server]
file=/tmp/supervisord.sock
chmod=0770

[supervisorctl]
serverurl=unix:///tmp/supervisord.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Celery Worker - Normal Priority
[program:celery-worker-normal]
command=%(here)s/../.venv/bin/python %(here)s/../worker.py
directory=%(here)s/..
environment=CELERY_QUEUES="normal_priority_ml,notifications,periodic",CELERY_CONCURRENCY="1",CELERY_POOL="threads",CELERY_LOGLEVEL="info",CELERY_HOSTNAME_SUFFIX="worker_normal"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stopwaitsecs=10
killasgroup=true

# Celery Worker - High Priority
[program:celery-worker-high]
command=%(here)s/../.venv/bin/python %(here)s/../worker.py
directory=%(here)s/..
environment=CELERY_QUEUES="high_priority_ml",CELERY_CONCURRENCY="2",CELERY_POOL="threads",CELERY_LOGLEVEL="info",CELERY_HOSTNAME_SUFFIX="worker_high"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stopwaitsecs=10
killasgroup=true

[program:celery-beat]
command=%(here)s/../.venv/bin/celery -A src.celery_app.app beat --loglevel=info --schedule=/tmp/celerybeat-schedule
directory=%(here)s/..
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[group:celery]
programs=celery-worker-normal,celery-worker-high,celery-beat
